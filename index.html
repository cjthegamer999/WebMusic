<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>WebMusic â€“ Private Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  background:#121212;
  color:white;
  font-family:Arial, sans-serif;
  margin:0;
  padding:20px;
}
.hidden { display:none; }
button,input {
  padding:8px;
  border-radius:6px;
  border:none;
}
button {
  background:#1db954;
  color:black;
  cursor:pointer;
}
input { width:100%; margin-bottom:10px; }
.song {
  margin:10px 0;
  padding:10px;
  background:#181818;
  border-radius:6px;
}
</style>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>

<body>

<h2>ðŸŽ§ WebMusic (Private Library)</h2>

<!-- AUTH -->
<div id="auth">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <p>Logged in as <span id="userEmail"></span></p>
  <button onclick="logout()">Logout</button>

  <h3>Upload MP3 (private)</h3>
  <input type="file" id="fileInput" accept="audio/mpeg">
  <button onclick="upload()">Upload</button>

  <h3>Your Library</h3>
  <div id="library"></div>

  <audio id="player" controls style="width:100%; margin-top:20px;"></audio>
</div>

<script>
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDXmhJB-AJlK6z8OZBY-6gfFU6jOzbHc7s",
  authDomain: "webmusic-eb2fb.firebaseapp.com",
  projectId: "webmusic-eb2fb",
  storageBucket: "webmusic-eb2fb.firebasestorage.app",
  messagingSenderId: "982822581676",
  appId: "1:982822581676:web:20b402e0ea4571f510f609",
  measurementId: "G-8PYLNDTNN7"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const authDiv = document.getElementById('auth');
const appDiv = document.getElementById('app');
const userEmail = document.getElementById('userEmail');
const library = document.getElementById('library');
const player = document.getElementById('player');

auth.onAuthStateChanged(user => {
  if (user) {
    authDiv.classList.add('hidden');
    appDiv.classList.remove('hidden');
    userEmail.innerText = user.email;
    loadSongs();
  } else {
    authDiv.classList.remove('hidden');
    appDiv.classList.add('hidden');
  }
});

/* AUTH */
function signup() {
  auth.createUserWithEmailAndPassword(
    email.value, password.value
  ).catch(alert);
}

function login() {
  auth.signInWithEmailAndPassword(
    email.value, password.value
  ).catch(alert);
}

function logout() {
  auth.signOut();
}

/* UPLOAD */
async function upload() {
  const file = fileInput.files[0];
  if (!file) return alert("Choose an MP3");

  if (file.size > 20 * 1024 * 1024)
    return alert("Max 20MB");

  const user = auth.currentUser;
  const ref = storage.ref(`uploads/${user.uid}/${Date.now()}_${file.name}`);

  await ref.put(file);
  const url = await ref.getDownloadURL();

  await db.collection("songs").add({
    uid: user.uid,
    name: file.name,
    url: url,
    created: firebase.firestore.FieldValue.serverTimestamp()
  });

  fileInput.value = "";
  loadSongs();
}

/* LOAD SONGS */
async function loadSongs() {
  library.innerHTML = "";
  const user = auth.currentUser;

  const snap = await db.collection("songs")
    .where("uid", "==", user.uid)
    .orderBy("created", "desc")
    .get();

  snap.forEach(doc => {
    const song = doc.data();
    const div = document.createElement("div");
    div.className = "song";
    div.innerText = song.name;
    div.onclick = () => player.src = song.url;
    library.appendChild(div);
  });
}
</script>

</body>
</html>

